<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AllenNLP Configuration Wizard</title>
    <style>
    </style>
  </head>
  <body>
    <h1>AllenNLP Configuration Wizard</h1>

    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
    <script type="text/babel">

        const TYPES = $types;
        const INFOS = $infos;

        const INITIAL_CONFIG = {
            'train_data_path': {'datatype': 'str'},
            'validation_data_path': {'datatype': ['union', 'str', 'None']},
            'model': {'datatype': 'allennlp.models.model.Model'},
            'iterator': {'datatype': 'allennlp.data.iterators.data_iterator.DataIterator'}
        };

        class App extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    config: INITIAL_CONFIG,
                    valid: false
                }
            }

            render() {
                return (
                    <div>
                        <h1>Configuration</h1>
                    {
                        Object.keys(this.state.config).map((key) => {
                            const value = this.state.config[key];
                            const datatype = value['datatype'];

                            if (datatype == 'str') {
                                return <StringChooser name={key} value={value}/>
                            } else {
                                return <div>{key}: {JSON.stringify(value)}</div>
                            }
                        })
                    }
                        <h1>Output</h1>
                    </div>
                );
            }
        }

        class StringChooser extends React.Component {
            constructor(props) {
                super(props);

                const {name, value} = props;
                const {datatype} = value;


                let choices = TYPES[datatype] && Object.keys(TYPES[datatype]);
                if (choices) {
                    choices = [''] + choices;
                }


                this.state = {
                    name,
                    value,
                    choices: choices,
                    children: null
                }

                this.handleListChange = this.handleListChange.bind(this);
            }

            handleListChange(e) {
                if (e.target.value) {

                } else {
                    this.setState({})
                }
            }

            render() {
                let dropdown;
                if (this.state.choices) {
                    dropdown = (
                        <select>
                            {
                                this.state.choices.map((choice) => {
                                    return (
                                        <option value={choice} onChange={this.handleListChange}>{choice}</option>
                                    )
                                })
                            }
                        </select>
                    )
                }
                return (
                    <div>
                        <div>{this.state.name}: {JSON.stringify(this.state.value)}</div>
                        {dropdown}
                    </div>
                )
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

  </body>
</html>
