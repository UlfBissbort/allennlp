<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AllenNLP Configuration Wizard</title>
    <style>
    </style>
  </head>
  <body>
    <h1>AllenNLP Configuration Wizard</h1>

    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
    <script type="text/babel">

        const TYPES = $types;

        const INFOS = $infos;

        const INITIAL_CONFIG = {
            'train_data_path': {
                "name": "train_data_path",
                "annotation": "str"
            },
            'validation_data_path': {
                "name": "validation_data_path",
                "optional": true,
                "annotation": "str"
            },
            'model': {
                "name": "model",
                'annotation': 'allennlp.models.model.Model'
            },
            'iterator': {
                "name": "iterator",
                "annotation": 'allennlp.data.iterators.data_iterator.DataIterator'
            }
        };

        class App extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    config: INITIAL_CONFIG,
                    valid: false
                }
            }

            render() {
                return (
                    <div>
                        <h1>Configuration</h1>
                    {
                        Object.keys(this.state.config).map((key) => {
                            const info = this.state.config[key];
                            const annotation = info['annotation'];

                            if (annotation == 'str') {
                                return <StringChooser info={info}/>
                            } else {
                                return <div>{key}: {JSON.stringify(info)}</div>
                            }
                        })
                    }
                        <h1>Output</h1>
                    </div>
                );
            }
        }

        class StringChooser extends React.Component {
            constructor(props) {
                super(props);

                const {info} = props;
                const {name, annotation, optional, defaultValue} = info;

                let choices = TYPES[annotation] && Object.keys(TYPES[annotation]);
                if (choices) {
                    choices = [''] + choices;
                }

                this.state = {
                    info,
                    choices: choices,
                    children: null
                }

                this.handleListChange = this.handleListChange.bind(this);
            }

            handleListChange(e) {
                if (e.target.value) {
                    //
                } else {
                    //
                }
            }

            render() {
                let dropdown;
                if (this.state.choices) {
                    dropdown = (
                        <select>
                            {
                                this.state.choices.map((choice) => {
                                    return (
                                        <option value={choice} onChange={this.handleListChange}>{choice}</option>
                                    )
                                })
                            }
                        </select>
                    )
                }
                return (
                    <div>
                        <div>{name}: {JSON.stringify(this.state.info)}</div>
                        {dropdown}
                    </div>
                )
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

  </body>
</html>
